# WebsocketとWebRTCを手元で動かしてみるリポジトリ

WebRTCを使用したシンプルな通話アプリケーション。同一ローカルネットワーク内での音声通話が可能です。
部屋の作成をして、その部屋に入ることで通話ができます。

## 機能

- ブラウザベースの音声通話
- マイクのミュート機能
- 通話の開始/終了
- エラー状態の表示

## 技術スタック

- TypeScript
- WebRTC
- WebSocket (シグナリング)

## 必要要件

### ブラウザ要件
- 推奨ブラウザ:
  - Google Chrome (最新版)

### システム要件
- Node.js 18以上
- マイク機能が利用可能なデバイス
- 同一ローカルネットワークへの接続

### 重要: HTTPSの要件
マイクへのアクセスには以下のいずれかの条件が必要です：
1. HTTPS接続での実行
2. localhost（127.0.0.1）での実行

## セットアップ

```bash
# 依存パッケージのインストール
npm install

# TypeScriptのビルド
npm run build
```

## 実行方法

### 開発モード（HTTP、localhostのみ）
```bash
npm run start:wss
npm run dev
```

これにより以下のサーバーが起動します：
- WebSocketシグナリングサーバー (ws://[ローカルIP]:8443)
- 静的ファイルサーバー (https://[ローカルIP]:3000)


## 他のデバイスからのアクセス方法

### 開発モード（localhost）
1. PCとスマートフォンが同じWi-Fiネットワークに接続されていることを確認
2. スマートフォンのブラウザで以下のURLにアクセス:
   ```
   https://[PCのIPアドレス]:3000
   ```
   注意: HTTPSが必要なため、一部の機能が制限される可能性があります


## ブラウザ別の注意事項

### Chrome
- HTTPSまたはlocalhostでの実行が必要
- マイクへのアクセス許可が必要
- chrome://settings/content/microphone で許可を確認

## テスト手順

### 1. ローカル環境での動作確認
1. `npm run dev`でサーバーを起動
2. ブラウザで https://localhost:3000 にアクセス
3. マイクの許可を確認
4. 通話機能をテスト

## トラブルシューティング

### マイクが使用できない場合
1. HTTPSまたはlocalhostで実行されているか確認
2. ブラウザの設定でマイクの許可を確認
3. システム設定でマイクが有効になっていることを確認
4. 他のアプリケーションがマイクを使用していないことを確認

### WebSocket接続エラーの場合
1. WebSocketサーバーが起動していることを確認
2. PCのIPアドレスが正しいことを確認
3. https://[wssサーバーのアドレス:8443]で接続して先に証明書を取得する
4. ポート8443が他のアプリケーションで使用されていないことを確認
5. ファイアウォールの設定を確認

## 既知の制限事項

- 同一ローカルネットワーク内での使用のみサポート
- 音声のみの通話（ビデオ通話は未サポート）
- 1対1の通話のみサポート（グループ通話は未サポート）
- HTTPSまたはlocalhostでの実行が必要（セキュリティ要件）
- プライベートブラウジングモードでは動作しない場合あり
- 一部の古いブラウザでは動作しない可能性あり